<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ãƒ«ãƒ¼ãƒˆè¡¨ç¤ºï¼ˆé£²é£Ÿåº—ã‚¸ãƒ£ãƒ³ãƒ«é¸æŠä»˜ãï¼‰</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    #map { height: 70vh; }
    #controls { padding: 10px; }
    label, select {
      margin-right: 10px;
      font-size: 16px;
    }
    select {
      padding: 4px 8px;
    }
    button {
      padding: 10px 16px;
      font-size: 16px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background-color: #0056b3;
    }
  
    /* ğŸ‘‡ ã“ã‚Œã‚’è¿½åŠ ï¼ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒˆã®å„é …ç›®ã«ä½™ç™½ã‚’è¿½åŠ  */
    #eventList li {
      margin-bottom: 30px;
    }
  </style>
  
</head>
<body>

    <div id="controls" style="display: flex; align-items: center; gap: 10px;">
      <label for="foodVisibility" style="white-space: nowrap;">
        é£²é£Ÿåº—ï¼š
        <select id="foodVisibility">
          <option value="show">è¡¨ç¤º</option>
          <option value="hide" selected>éè¡¨ç¤º</option>
        </select>
      </label>
  
      <label for="categoryFilter" id="genreLabel" style="display:none; white-space: nowrap;">
        é£²é£Ÿåº—ã‚¸ãƒ£ãƒ³ãƒ«:
        <select id="categoryFilter">
          <option value="æ´‹é£Ÿ">æ´‹é£Ÿ</option>
          <option value="ã¨ã‚“ã‹ã¤">ã¨ã‚“ã‹ã¤</option>
          <option value="ãƒ©ãƒ¼ãƒ¡ãƒ³">ãƒ©ãƒ¼ãƒ¡ãƒ³</option>
          <option value="ã†ã©ã‚“">ã†ã©ã‚“</option>
          <option value="æ‰‹ç¾½å…ˆ">æ‰‹ç¾½å…ˆ</option>
          <option value="å±…é…’å±‹">å±…é…’å±‹</option>
          <option value="å–«èŒ¶åº—">å–«èŒ¶åº—</option>
          <option value="ãŠã«ãã‚Š">ãŠã«ãã‚Š</option>
          <option value="ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼">ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼</option>
          <option value="å°ç± åŒ…">å°ç± åŒ…</option>
          <option value="ã²ã¤ã¾ã¶ã—">ã²ã¤ã¾ã¶ã—</option>
          <option value="ãƒ•ãƒ©ã‚¤ãƒ‰ãƒãƒ†ãƒˆ">ãƒ•ãƒ©ã‚¤ãƒ‰ãƒãƒ†ãƒˆ</option>
          <option value="ã‹ã‚‰æšã’">ã‹ã‚‰æšã’</option>
          <option value="å‘³å™Œã‚«ãƒ„">å‘³å™Œã‚«ãƒ„</option>
          <option value="éŸ“å›½å±‹å°">éŸ“å›½å±‹å°</option>
          <option value="ä¸­è¯">ä¸­è¯</option>
          <option value="ãŸã“ç„¼ã">ãŸã“ç„¼ã</option>
          <option value="äº”å¹³é¤…">äº”å¹³é¤…</option>
          <option value="åå¤å±‹ã‚³ãƒ¼ãƒãƒ³">åå¤å±‹ã‚³ãƒ¼ãƒãƒ³</option>
          <option value="çŠ¬å±±ãƒ‰ãƒƒã‚°">çŠ¬å±±ãƒ‰ãƒƒã‚°</option>
          <option value="ç‰›ä¸²">ç‰›ä¸²</option>
          <option value="è‚‰å¯¿å¸">è‚‰å¯¿å¸</option>
          <option value="ã‚¹ã‚¤ãƒ¼ãƒ„">ã‚¹ã‚¤ãƒ¼ãƒ„</option>
        </select>
      </label>
  
      <!-- è¡Œå…ˆä¸€è¦§ç”¨ãƒˆã‚°ãƒ«ãƒœã‚¿ãƒ³ -->
      



  
      <!-- ã‚¤ãƒ™ãƒ³ãƒˆè¡¨ç¤ºã‚»ãƒ¬ã‚¯ãƒˆã¨ãƒœã‚¿ãƒ³ -->
      <label for="eventVisibility" style="white-space: nowrap; margin-left: 20px;">
        ã‚¤ãƒ™ãƒ³ãƒˆï¼š
        <select id="eventVisibility">
          <option value="show">è¡¨ç¤º</option>
          <option value="hide" selected>éè¡¨ç¤º</option>
        </select>
      </label>

      <button id="toggleEventPanel" style="
  margin-left: 8px;
  padding: 6px 12px;
  background-color: #b82fa1;
  color: white;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-size: 14px;
">ã‚¤ãƒ™ãƒ³ãƒˆè©³ç´°æƒ…å ±</button>


<button id="toggleDestinationPanel" style="
        margin-left: 20px;
        padding: 6px 12px;
        background-color: #2a7ae2;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
      ">è¡Œãå…ˆä¸€è¦§</button>
  
      <!-- ã‚¤ãƒ™ãƒ³ãƒˆè©³ç´°æƒ…å ±ãƒœã‚¿ãƒ³ï¼ˆåˆæœŸã¯éè¡¨ç¤ºï¼‰ -->
      

  
    </div>
  
    <!-- è¡Œå…ˆä¸€è¦§ãƒ‘ãƒãƒ«ï¼ˆå³ç«¯ï¼‰ -->
   <!-- è¡Œå…ˆä¸€è¦§ãƒ‘ãƒãƒ«ï¼ˆå³ç«¯ï¼‰ -->
<div id="destinationPanel" style=" 
position: fixed;
top: 0;
right: -320px; /* åˆæœŸã¯éš ã‚Œã¦ã„ã‚‹ */
width: 320px;
height: 100%;
background: white;
border-left: 1px solid #ccc;
box-shadow: -2px 0 5px rgba(0,0,0,0.2);
overflow-y: auto;
padding: 10px;
transition: right 0.3s ease;
z-index: 999;
">
<h3>è¡Œå…ˆä¸€è¦§</h3>
<ul id="destinationList" style="padding-left: 20px; margin: 0;">
  <!-- ä¾‹ã¨ã—ã¦é©å½“ãªè¡Œå…ˆ -->
  <li>åå¤å±‹åŸ</li>
  <li>ç†±ç”°ç¥å®®</li>
  <li>ã‚ªã‚¢ã‚·ã‚¹21</li>
  <li>å¤§é ˆå•†åº—è¡—</li>
</ul>
</div>

  
    <!-- ã‚¤ãƒ™ãƒ³ãƒˆãƒ‘ãƒãƒ«ï¼ˆå³ç«¯ï¼‰ -->
    <div id="eventPanel" style="
      position: fixed;
      top: 0;
      right: -320px; /* åˆæœŸã¯éš ã‚Œã¦ã„ã‚‹ */
      width: 320px;
      height: 100%;
      background: white;
      border-left: 1px solid #ccc;
      box-shadow: -2px 0 5px rgba(0,0,0,0.2);
      overflow-y: auto;
      padding: 10px;
      transition: right 0.3s ease;
      z-index: 999;
    ">
      <h3>ã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§</h3>
      <ul id="eventList" style="padding-left: 20px; margin: 0;"></ul>
    </div>
  
    <script>
      // è¦ç´ å–å¾—

      let selectedDestinations = [];  // è¡Œãå…ˆä¸€è¦§ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒã™ã‚‹é…åˆ—
      const eventVisibilitySelect = document.getElementById('eventVisibility');
      const toggleEventBtn = document.getElementById('toggleEventPanel');
      const eventPanel = document.getElementById('eventPanel');
  
      const toggleDestinationBtn = document.getElementById('toggleDestinationPanel');
      const destinationPanel = document.getElementById('destinationPanel');
  
      // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒˆã®ãƒ‡ãƒ¼ã‚¿ã¨æç”»é–¢æ•°
      
      function renderEventList() {

        const eventSpots = [
        { name: "ã‚ªãƒ‡ã‚£ãƒ­ãƒ³ãƒ»ãƒ«ãƒ‰ãƒ³ã€€å¤¢ã®äº¤å‰ã€€â€•ç”»å®¶ã¨ã—ã¦ã€æ‰¹è©•å®¶ã¨ã—ã¦â€•ã€€ã€€[ç¾è¡“å±•]", url: "https://www.nagoya-info.jp/event/detail/1255/" },
        { name: "ç™½é³¥åº­åœ’ ç§‹éœ²ç¥­ã€€ã€€[ã‚®ãƒ£ãƒ©ãƒªãƒ¼ãƒˆãƒ¼ã‚¯ã€ã‚¢ãƒ¼ãƒˆãƒ„ã‚¢ãƒ¼]", url: "https://www.nagoya-info.jp/event/detail/98/" },
        { name: "ä¼ç”»å±•ã€Œè‘—åãªåˆ€å·¥ï½å¤åˆ€ã‹ã‚‰æ–°åˆ€ã¾ã§ï½ã€ã€€ã€€[å±•ç¤º]", url: "https://www.nagoya-info.jp/event/detail/1244/" }
      ];
  
        const eventList = document.getElementById('eventList');
        eventList.innerHTML = ''; // ã‚¯ãƒªã‚¢
  
        eventSpots.forEach(event => {
          const li = document.createElement('li');
          const a = document.createElement('a');
          a.href = event.url;
          a.textContent = event.name;
          a.target = '_blank';
          a.rel = 'noopener noreferrer';
          li.appendChild(a);
          eventList.appendChild(li);
        });
      }
  
      // è¡Œå…ˆä¸€è¦§ãƒˆã‚°ãƒ«ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
      // è¡Œå…ˆä¸€è¦§ãƒˆã‚°ãƒ«ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
toggleDestinationBtn.addEventListener('click', () => {
  const isDestOpen = destinationPanel.style.right === '0px';

  if (isDestOpen) {
    // é–‰ã˜ã‚‹
    destinationPanel.style.right = '-320px';
  } else {
    // é–‹ãå‰ã«ã‚¤ãƒ™ãƒ³ãƒˆãƒ‘ãƒãƒ«é–‰ã˜ã‚‹
    eventPanel.style.right = '-320px';
    destinationPanel.style.right = '0px'; // ã“ã“ã§ãƒ‘ãƒãƒ«ã‚’å³ã‹ã‚‰å‡ºã™
  }
});

  
      // ã‚¤ãƒ™ãƒ³ãƒˆè©³ç´°ã®è¡¨ç¤ºåˆ‡æ›¿ã‚»ãƒ¬ã‚¯ãƒˆå¤‰æ›´æ™‚ã®å‡¦ç†
      eventVisibilitySelect.addEventListener('change', (e) => {
        if (e.target.value === 'show') {
          toggleEventBtn.style.display = 'inline-block';
        } else {
          toggleEventBtn.style.display = 'none';
          closeEventPanel();
        }
      });
  
      // ã‚¤ãƒ™ãƒ³ãƒˆè©³ç´°æƒ…å ±ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
      toggleEventBtn.addEventListener('click', () => {
        const isEventOpen = eventPanel.style.right === '0px';
  
        if (isEventOpen) {
          eventPanel.style.right = '-320px';
        } else {
          // è¡Œå…ˆä¸€è¦§ãƒ‘ãƒãƒ«é–‰ã˜ã‚‹
          destinationPanel.style.right = '-320px';
          eventPanel.style.right = '0px';
          renderEventList();
        }
      });
  
      // ã‚¤ãƒ™ãƒ³ãƒˆãƒ‘ãƒãƒ«ã‚’é–‰ã˜ã‚‹é–¢æ•°
      function closeEventPanel() {
        eventPanel.style.right = '-320px';
      }
  
    </script>
  
  </body>
  
  

      
      
      
              
    
    
  
      


 
        
        
        


      </select>
    </label>

    <button id="updateBtn">æ›´æ–°</button>
  </div>

  <!-- è¡Œãå…ˆä¸€è¦§ãƒ‘ãƒãƒ« -->

  
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    // ã‚¢ã‚¤ã‚³ãƒ³è¨­å®šï¼ˆèµ¤ï¼ç¾åœ¨åœ°ã€ç·‘ï¼é§…ï¼‰
    const redIcon = L.icon({
      iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-red.png',
      iconSize: [25, 41],
      iconAnchor: [12, 41],
      popupAnchor: [1, -34],
      shadowUrl: 'https://unpkg.com/leaflet@1.7.1/dist/images/marker-shadow.png',
      shadowSize: [41, 41]
    });
    const stationIcon = L.icon({
      iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-green.png',
      iconSize: [25, 41],
      iconAnchor: [12, 41],
      popupAnchor: [1, -34],
      shadowUrl: 'https://unpkg.com/leaflet@1.7.1/dist/images/marker-shadow.png',
      shadowSize: [41, 41]
    });

    const foodIcon = L.icon({
  iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-orange.png',
  iconSize: [25, 41],
  iconAnchor: [12, 41],
  popupAnchor: [1, -34],
  shadowUrl: 'https://unpkg.com/leaflet@1.7.1/dist/images/marker-shadow.png',
  shadowSize: [41, 41]
});


const shikiIcon = L.icon({
  iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-blue.png',
  iconSize: [25, 41],
  iconAnchor: [12, 41],
  popupAnchor: [1, -34],
  shadowUrl: 'https://unpkg.com/leaflet@1.7.1/dist/images/marker-shadow.png',
  shadowSize: [41, 41]
});

const eventIcon = L.icon({
  iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-violet.png',
  iconSize: [25, 41],
  iconAnchor: [12, 41],
  popupAnchor: [1, -34],
  shadowUrl: 'https://unpkg.com/leaflet@1.7.1/dist/images/marker-shadow.png',
  shadowSize: [41, 41]
});

  const spots = [
    { name: "ã€Œã‚·ã‚­ã‚¶ã‚¯ãƒ©ã€ç†±ç”°ç¥å®®", lat: 35.12776500157432,   lng: 136.90841903570887 ,category: "ã‚·ã‚­ã‚¶ã‚¯ãƒ©", prefecture: "æ„›çŸ¥çœŒ"},
    { name: "ã€Œã‚·ã‚­ã‚¶ã‚¯ãƒ©ã€çŠ¬å±±é§…", lat: 35.38059731323793,   lng: 136.94567929145734 ,category: "ã‚·ã‚­ã‚¶ã‚¯ãƒ©", prefecture: "æ„›çŸ¥çœŒ"},
    { name: "ã€Œã‚·ã‚­ã‚¶ã‚¯ãƒ©ã€çŠ¬å±±åŸ", lat: 35.389225991224855, lng:  136.93649363916643 ,category: "ã‚·ã‚­ã‚¶ã‚¯ãƒ©", prefecture: "æ„›çŸ¥çœŒ"},
    { name: "ã€Œã‚·ã‚­ã‚¶ã‚¯ãƒ©ã€å¤§é ˆè¦³éŸ³", lat: 35.16026860499404,  lng:136.89983326064777 ,category: "ã‚·ã‚­ã‚¶ã‚¯ãƒ©", prefecture: "æ„›çŸ¥çœŒ"},
    { name: "ã€Œã‚·ã‚­ã‚¶ã‚¯ãƒ©ã€å¤§é ˆå•†åº—è¡—", lat: 35.1606448420087,  lng: 136.90276190233686  ,category: "ã‚·ã‚­ã‚¶ã‚¯ãƒ©", prefecture: "æ„›çŸ¥çœŒ"},
    { name: "ã€Œã‚·ã‚­ã‚¶ã‚¯ãƒ©ã€åå¤å±‹åŸ", lat: 35.184979548514484,  lng:136.8995649183877  ,category: "ã‚·ã‚­ã‚¶ã‚¯ãƒ©", prefecture: "æ„›çŸ¥çœŒ"},
    { name: "ã€Œã‚·ã‚­ã‚¶ã‚¯ãƒ©ã€åå¤å±‹ãƒ†ãƒ¬ãƒ“å¡”", lat: 35.17274460341759,  lng:  136.90853042683023 ,category: "ã‚·ã‚­ã‚¶ã‚¯ãƒ©", prefecture: "æ„›çŸ¥çœŒ"},
    { name: "ã€Œã‚·ã‚­ã‚¶ã‚¯ãƒ©ã€æ±å±±å‹•æ¤ç‰©åœ’", lat: 35.15681366811172,  lng: 136.98207535973015,category: "ã‚·ã‚­ã‚¶ã‚¯ãƒ©", prefecture: "æ„›çŸ¥çœŒ"},
    { name: "ã€Œã‚·ã‚­ã‚¶ã‚¯ãƒ©ã€åé‰„çŠ¬å±±ç·š", lat: 35.380544604718175, lng:  136.94566896329292 ,category: "ã‚·ã‚­ã‚¶ã‚¯ãƒ©", prefecture: "æ„›çŸ¥çœŒ"}
  ];

  const stations = [
       { name: "å›½åºœé§…", lat: 34.837651602630245, lng:137.32811256748445 },
    { name: "å…«å¹¡é§…", lat: 34.829160933354544, lng: 137.35220761449636 },
    { name: "è«è¨ªç”ºé§…", lat: 34.823401411202326,  lng: 137.3707225886341 },
    { name: "ç¨²è·å£é§…", lat: 34.818547644962294, lng: 137.38721416345334},
    { name: "è±Šå·ç¨²è·é§…", lat: 34.822426223650524, lng: 137.39650415565973} ,
  { name: "å°ç”°æ¸•é§…", lat: 34.81455923033158, lng: 137.34581725846888 },
  { name: "å›½åºœé§…", lat: 34.837737296653415, lng: 137.3272793431578 },
  { name: "åé›»èµ¤å‚é§…", lat: 34.85911739255532, lng: 137.3112840315493 },
  { name: "åé›»é•·æ²¢é§…", lat: 34.87157485251886, lng: 137.28822490512604 },
  { name: "æœ¬å®¿é§…", lat: 34.89279851898171, lng: 137.26020664030185 },
  { name: "åé›»å±±ä¸­é§…", lat: 34.89958174936259, lng: 137.2425464604365 },
  { name: "è—¤å·é§…", lat: 34.913249133400875, lng: 137.21845279361247 },
  { name: "ç¾åˆé§…", lat: 34.92393546357745, lng: 137.19644405142026 },
  { name: "ç”·å·é§…", lat: 34.937674246945264, lng: 137.18321993672555 },
  { name: "æ±å²¡å´é§…", lat: 34.95204894682275, lng: 137.1675868119976 },
  { name: "å²¡å´å…¬åœ’å‰é§…", lat: 34.95536883841294, lng: 137.15269679915798 },
  { name: "çŸ¢ä½œæ©‹é§…", lat: 34.95536345301406, lng: 137.15267971514035 },
  { name: "å®‡é ­é§…", lat: 34.971381733821296, lng: 137.11822541288672 },
  { name: "æ–°å®‰åŸé§…", lat: 34.98701046196139, lng: 137.0851862102096 },
  { name: "çŸ¥ç«‹é§…", lat: 35.00586728430269, lng: 137.03964650243515 },
  { name: "ä¸€ãƒ„æœ¨é§…", lat: 35.01380659631589, lng: 137.0254059487408 },
  { name: "å¯Œå£«æ¾é§…", lat: 35.0294385080383, lng: 137.01682099543393 },
  { name: "è±Šæ˜é§…", lat: 35.040882549510776, lng: 137.00836261240397 },
  { name: "å‰å¾Œé§…", lat: 35.05231966226537, lng: 136.995598354629 },
  { name: "ä¸­äº¬ç«¶é¦¬å ´å‰é§…", lat: 35.06127732683306, lng: 136.98152254959754 },
  { name: "æœ‰æ¾é§…", lat: 35.06748360601862, lng: 136.97134336855171 },
  { name: "å·¦äº¬å±±é§…", lat: 35.067458079668015, lng: 136.97133823662998 },
  { name: "é³´æµ·é§…", lat: 35.07843473847971, lng: 136.9507456372692 },
  { name: "æœ¬æ˜Ÿå´é§…", lat: 35.086910761867934, lng: 136.9374200452981 },
  { name: "æœ¬ç¬ å¯ºé§…", lat: 35.09933921273592, lng: 136.93346649644948 },
  { name: "æ¡œé§…", lat: 35.10630036744282, lng: 136.9346167049898 },
  { name: "å‘¼ç¶šé§…", lat: 35.1143549739723, lng: 136.9305869289135 },
  { name: "å €ç”°é§…", lat: 35.12013396388444, lng: 136.9197549996976 },
  { name: "ç¥å®®å‰é§…", lat: 35.125719425051514, lng: 136.91250199053744 },
  { name: "é‡‘å±±é§…", lat: 35.142811915632535, lng: 136.90118597682405 },
  { name: "å±±ç‹é§…", lat: 35.152600955236856, lng: 136.8885397018134 },
  { name: "åé‰„åå¤å±‹é§…", lat: 35.17036502060045, lng: 136.88428767949588 },
  { name: "æ „ç”Ÿé§…", lat: 35.18339963525929, lng: 136.87355145820862 },
  { name: "æ±æ‡æ·å³¶é§…", lat: 35.189750687878714, lng: 136.87024488475785 },
  { name: "è¥¿æ‡æ·å³¶é§…", lat: 35.195062841143375, lng: 136.86549299909257 },
  { name: "äºŒãƒ„æé§…", lat: 35.19486064065193, lng: 136.85957860839156 },
  { name: "æ–°å·æ©‹é§…", lat: 35.1957439113549, lng: 136.85191035094343 },
  { name: "é ˆãƒ¶å£é§…", lat: 35.19867036557675, lng: 136.84618795515172 },
  { name: "ä¸¸ã®å†…é§…", lat: 35.174008306328865, lng: 136.89680675254283 },
  { name: "æ–°æ¸…æ´²é§…", lat: 35.21123277752584, lng: 136.83563355803008 },
  { name: "å¤§é‡Œé§…", lat: 35.226212814492655, lng: 136.81835653659 },
  { name: "å¥¥ç”°é§…", lat: 35.2355152690392, lng: 136.8108151394045 },
  { name: "å›½åºœå®®é§…", lat: 35.25366223534117, lng: 136.80291340647108 },
  { name: "å³¶æ°æ°¸é§…", lat: 35.27130776419317, lng: 136.80091312280416 },
  { name: "å¦™èˆˆå¯ºé§…", lat: 35.28731187952675, lng: 136.798218579144 },
  { name: "åé‰„ä¸€å®®é§…", lat: 35.30166596951043, lng: 136.79703499621644 },
  { name: "ä»Šä¼Šå‹¢é§…", lat: 35.318185209955324, lng: 136.78931117884582 },
  { name: "çŸ³åˆ€é§…", lat: 35.32632986643017, lng: 136.78535461169542 },
  { name: "æ–°æœ¨æ›½å·é§…", lat: 35.34273720039879, lng: 136.7794333149385 },
  { name: "é»’ç”°é§…", lat: 35.35064664281565, lng: 136.77744240938148 },
  { name: "æœ¨æ›½å·å ¤é§…", lat: 35.36525226564715, lng: 136.77033085064554 },
  { name: "ç¬ æ¾é§…", lat: 35.37420160036604, lng: 136.7643676839017 },
  { name: "å²å—é§…", lat: 35.389690094935446, lng: 136.76926345843248 },
  { name: "èŒ¶æ‰€é§…", lat: 35.4023589356843, lng: 136.7688290363146 },
  { name: "åŠ ç´é§…", lat: 35.405140938668076, lng: 136.76655658705764 },
  { name: "åé‰„å²é˜œé§…", lat: 35.40959672272171, lng: 136.75714667604456 },
  { name: "æ–°å®‰åŸé§…", lat: 34.98709306475588, lng: 137.08518414718486 },
{ name: "åŒ—å®‰åŸé§…", lat: 34.96478825036819, lng: 137.09198492722388 },
{ name: "å—å®‰åŸé§…", lat: 34.951979396832165, lng: 137.0924599797348 },
{ name: "ç¢§æµ·å¤äº•é§…", lat: 34.93689652104654, lng: 137.090840764388 },
{ name: "å €å†…å…¬åœ’é§…", lat: 34.92750669448915, lng: 137.08976207788822 },
{ name: "æ¡œäº•é§…", lat: 34.91797001091605, lng: 137.08822602360263 },
{ name: "å—æ¡œäº•é§…", lat: 34.90623069721641, lng: 137.07708035749258 },
{ name: "ç±³æ´¥é§…", lat: 34.892908401534584, lng: 137.06093161226815 },
{ name: "æ¡œç”ºå‰é§…", lat: 34.880175673281926, lng: 137.06238422985447 },
{ name: "è¥¿å°¾å£é§…", lat: 34.870509984185134, lng: 137.06249012021482 },
{ name: "è¥¿å°¾é§…", lat: 34.86380039212141, lng: 137.05774160301215 },
{ name: "ç¦åœ°é§…", lat: 34.84432447641963, lng: 137.04847017787523 },
{ name: "ä¸Šæ¨ªé ˆè³€é§…", lat: 34.829897354863824, lng: 137.07196015002867 },
{ name: "å‰è‰¯å‰ç”°é§…", lat: 34.79403238404487, lng: 137.0710534932184 },
{ name: "ä¸‰æ²³é³¥ç¾½é§…", lat: 34.79322798771531, lng: 137.10496836622394 },
{ name: "è¥¿å¹¡è±†é§…", lat: 34.792432094598595, lng: 137.1211437932309 },
{ name: "æ±å¹¡è±†é§…", lat: 34.789582327840435, lng: 137.14569877237489 },
{ name: "ã“ã©ã‚‚ã®å›½é§…", lat: 34.7887682388797, lng: 137.16288396807815 },
{ name: "è¥¿æµ¦é§…", lat: 34.790087072414906, lng: 137.17865963553749 },
{ name: "ç‰‡åŸé§…", lat: 34.79881862492501, lng: 137.18468757413476 },
{ name: "ä¸‰æ²³é¹¿å³¶é§…", lat: 34.813308440960725, lng: 137.189730951564 },
{ name: "è’²éƒ¡ç«¶è‰‡å ´å‰é§…", lat: 34.825593513761106, lng: 137.20219682657938 },
{ name: "è’²éƒ¡é§…", lat: 34.82288937364543, lng: 137.22627334110132 },
{ name: "çŸ¥ç«‹é§…", lat: 35.00592243352234, lng: 137.03959361835518 },
{ name: "é‡åŸé§…", lat: 34.99509562568579, lng: 137.02407312020384 },
{ name: "åˆˆè°·é§…", lat: 34.99109317883324, lng: 137.00888805464905 },
{ name: "åˆˆè°·å¸‚é§…", lat: 34.984798950598616, lng: 136.9938331314778 },
{ name: "å°å£æ±Ÿé§…", lat: 34.963769961675524, lng: 136.99540301333468 },
{ name: "å‰æµœé§…", lat: 34.94642957158757, lng: 136.98905836442788 },
{ name: "ä¸‰æ²³é«˜æµœé§…", lat: 34.9305247059775, lng: 136.99008682205798 },
{ name: "é«˜æµœæ¸¯é§…", lat: 34.921123901489, lng: 136.98922759323284 },
{ name: "åŒ—æ–°å·é§…", lat: 34.90630641050556, lng: 136.99254837973723 },
{ name: "æ–°å·ç”ºé§…", lat: 34.89634340217784, lng: 136.98999007788316 },
{ name: "ç¢§å—ä¸­å¤®é§…", lat: 34.88716395147377, lng: 136.98963515773957 },
{ name: "ç¢§å—é§…", lat: 34.87389758034796, lng: 136.9855572355579 },
{ name: "åé‰„åå¤å±‹é§…", lat: 35.169622, lng: 136.883958 },
{ name: "æ „ç”Ÿé§…", lat: 35.183412, lng: 136.873554 },
{ name: "æ±æ‡æ·å³¶é§…", lat: 35.189680, lng: 136.870315 },
{ name: "ä¸‹å°ç”°äº•é§…", lat: 35.201903, lng: 136.870649 },
{ name: "ä¸­å°ç”°äº•é§…", lat: 35.214847, lng: 136.876950 },
{ name: "ä¸Šå°ç”°äº•é§…", lat: 35.223724, lng: 136.876881 },
{ name: "è¥¿æ˜¥é§…", lat: 35.244607, lng: 136.871238 },
{ name: "å¾³é‡åå¤å±‹èŠ¸å¤§é§…", lat: 35.256153, lng: 136.873405 },
{ name: "å¤§å±±å¯ºé§…", lat: 35.263335, lng: 136.874692 },
{ name: "å²©å€‰é§…", lat: 35.278292, lng: 136.873503 },
{ name: "çŸ³ä»é§…", lat: 35.296165, lng: 136.871107 },
{ name: "å¸ƒè¢‹é§…", lat: 35.317940, lng: 136.872490 },
{ name: "æ±Ÿå—é§…", lat: 35.335186, lng: 136.872095 },
{ name: "æ ¢æ£®é§…", lat: 35.344918, lng: 136.900420 },
{ name: "æ‰¶æ¡‘é§…", lat: 35.359687, lng: 136.916087 },
{ name: "æœ¨æ´¥ç”¨æ°´é§…", lat: 35.366922, lng: 136.926116 },
{ name: "çŠ¬å±±å£é§…", lat: 35.374165, lng: 136.939487 },
{ name: "çŠ¬å±±é§…", lat: 35.380250, lng: 136.945650 },
{ name: "çŠ¬å±±éŠåœ’é§…", lat: 35.390428, lng: 136.947130 },
{ name: "æ–°éµœæ²¼é§…", lat: 35.396383, lng: 136.944240 },
{ name: "æ „ç”ºé§…", lat: 35.170739, lng: 136.908875 },
{ name: "æ±å¤§æ‰‹é§…", lat: 35.183726, lng: 136.908381 },
{ name: "æ¸…æ°´é§…", lat: 35.187126, lng: 136.913711 },
{ name: "å°¼ã‚±å‚é§…", lat: 35.187968, lng: 136.919277 },
{ name: "æ£®ä¸‹é§…", lat: 35.188272, lng: 136.929243 },
{ name: "å¤§æ›½æ ¹é§…", lat: 35.191524, lng: 136.936853 },
{ name: "çŸ¢ç”°é§…", lat: 35.193689, lng: 136.947823 },
{ name: "å®ˆå±±è‡ªè¡›éšŠå‰é§…", lat: 35.196228, lng: 136.957964 },
{ name: "ç“¢ç®ªå±±é§…", lat: 35.197210, lng: 136.965067 },
{ name: "å°å¹¡é§…", lat: 35.200199, lng: 136.975858 },
{ name: "å–œå¤šå±±é§…", lat: 35.205191, lng: 136.987721 },
{ name: "å¤§æ£®ãƒ»é‡‘åŸå­¦é™¢å‰é§…", lat: 35.206871, lng: 136.996412 },
{ name: "å°å ´é§…", lat: 35.211098, lng: 137.011238 },
{ name: "æ—­å‰é§…", lat: 35.214221, lng: 137.019997 },
{ name: "å°¾å¼µæ—­é§…", lat: 35.216729, lng: 137.036384 },
{ name: "ä¸‰éƒ·é§…", lat: 35.216352, lng: 137.052086 },
{ name: "æ°´é‡é§…", lat: 35.224359, lng: 137.069888 },
{ name: "æ–°ç€¬æˆ¸é§…", lat: 35.225641, lng: 137.077936 },
{ name: "ç€¬æˆ¸å¸‚å½¹æ‰€å‰é§…", lat: 35.225159, lng: 137.084473 },
{ name: "å°¾å¼µç€¬æˆ¸é§…", lat: 35.225183, lng: 137.097306 },
{ name: "ä¸‰æ²³çŸ¥ç«‹é§…", lat: 35.00560041170529, lng: 137.0551619183601 },
{ name: "ä¸‰æ²³å…«æ©‹é§…", lat: 35.01073311599255, lng: 137.07716398397795 },
{ name: "è‹¥æ—é§…", lat: 35.026617538719215, lng: 137.0968326893095 },
{ name: "ç«¹æ‘é§…", lat: 35.040151823635696, lng: 137.11513070671333 },
{ name: "åœŸæ©‹é§…", lat: 35.058181444261145, lng: 137.12972190487756 },
{ name: "ä¸ŠæŒ™æ¯é§…", lat: 35.07221129037227, lng: 137.1549372778867 },
{ name: "è±Šç”°å¸‚é§…", lat: 35.08707361416158, lng: 137.15622355929824 },
{ name: "æ¢…åªé§…", lat: 35.099954939261515, lng: 137.16239352522703 },
{ name: "è¶Šæˆ¸é§…", lat: 35.10768268847012, lng: 137.17988156623647 },
{ name: "å¹³æˆ¸æ©‹é§…", lat: 35.114725783254215, lng: 137.18466029138074 },
{ name: "çŒ¿æŠ•é§…", lat: 35.12255638619787, lng: 137.1787326355515 },
{ name: "éµœæ²¼å®¿é§…", lat: 35.400013, lng: 136.932580 },
{ name: "ç¾½å ´é§…", lat: 35.401231, lng: 136.921690 },
{ name: "è‹§ãƒ¶ç€¬é§…", lat: 35.403439, lng: 136.911986 },
{ name: "åé›»å„å‹™åŸé§…", lat: 35.402846, lng: 136.901439 },
{ name: "äºŒåè»’é§…", lat: 35.400144, lng: 136.889195 },
{ name: "ä¸‰æŸ¿é‡é§…", lat: 35.400278, lng: 136.875470 },
{ name: "å…­è»’é§…", lat: 35.400972, lng: 136.862049 },
{ name: "å„å‹™åŸå¸‚å½¹æ‰€å‰é§…", lat: 35.400883, lng: 136.847184 },
{ name: "å¸‚æ°‘å…¬åœ’å‰é§…", lat: 35.400632, lng: 136.841838 },
{ name: "æ–°é‚£åŠ é§…", lat: 35.400133, lng: 136.833841 },
{ name: "æ–°åŠ ç´é§…", lat: 35.399362, lng: 136.824404 },
{ name: "é«˜ç”°æ©‹é§…", lat: 35.398494, lng: 136.811919 },
{ name: "æ‰‹åŠ›é§…", lat: 35.398264, lng: 136.804689 },
{ name: "åˆ‡é€šé§…", lat: 35.400074, lng: 136.796055 },
{ name: "ç´°ç•‘é§…", lat: 35.401662, lng: 136.785262 },
{ name: "ç”°ç¥é§…", lat: 35.411351, lng: 136.772149 },
{ name: "åé‰„å²é˜œé§…", lat: 35.411709, lng: 136.759821 },
{ name: "ä¸Šè±Šç”°é§…", lat: 35.11657718396344, lng: 137.1546158643943 },
{ name: "æµ„æ°´é§…", lat: 35.12125813472798, lng: 137.13745733370072 },
{ name: "ä¸‰å¥½ã‚±ä¸˜é§…", lat: 35.12690863853301, lng: 137.11117444902976 },
{ name: "é»’å´é§…", lat: 35.127692529410666, lng: 137.09131910876334 },
{ name: "ç±³é‡æœ¨é§…", lat: 35.12389093629811, lng: 137.0670430085792 },
{ name: "æ—¥æ¸…é§…", lat: 35.11845013529704, lng: 137.0490711175508 },
{ name: "èµ¤æ± é§…", lat: 35.12119900930031, lng: 137.01830427203097 },
{ name: "ç¾½é»’é§…", lat: 35.351371, lng: 136.952528 },
{ name: "æ¥½ç”°é§…", lat: 35.330882, lng: 136.950088 },
{ name: "ç”°çœŒç¥ç¤¾å‰é§…", lat: 35.317772, lng: 136.943811 },
{ name: "å‘³å²¡é§…", lat: 35.309298, lng: 136.940398 },
{ name: "å°ç‰§åŸé§…", lat: 35.300121, lng: 136.935857 },
{ name: "å°ç‰§é§…", lat: 35.289186, lng: 136.928119 },
{ name: "å°ç‰§å£é§…", lat: 35.281917, lng: 136.927548 },
{ name: "é–“å†…é§…", lat: 35.281917, lng: 136.927548 },
{ name: "ç‰›å±±é§…", lat: 35.264253, lng: 136.931276 },
{ name: "æ˜¥æ—¥äº•é§…", lat: 35.250335, lng: 136.936240 },
{ name: "å‘³ç¾é§…", lat: 35.235202, lng: 136.937140 },
{ name: "å‘³é‹ºé§…", lat: 35.222642, lng: 136.936233 },
{ name: "ä¸Šé£¯ç”°é§…", lat: 35.203853, lng: 136.929648 },
{ name: "å¯Œå²¡å‰é§…", lat: 35.379586, lng: 136.962275 },
{ name: "å–„å¸«é‡é§…", lat: 35.389516, lng: 136.979769 },
{ name: "è¥¿å¯å…é§…", lat: 35.404707, lng: 137.010884 },
{ name: "å¯å…å·é§…", lat: 35.418514, lng: 137.018191 },
{ name: "æ—¥æœ¬ãƒ©ã‚¤ãƒ³ä»Šæ¸¡é§…", lat: 35.432355, lng: 137.036546 },
{ name: "æ–°å¯å…é§…", lat: 35.422547, lng: 137.055514 },
{ name: "è¥¿ç¬ æ¾é§…", lat: 35.369070, lng: 136.757898 },
  { name: "æŸ³æ´¥é§…", lat: 35.365125, lng: 136.739523 },
  { name: "å—å®¿é§…", lat: 35.347849, lng: 136.728549 },
  { name: "é ˆåŠ é§…", lat: 35.339786, lng: 136.726546 },
  { name: "ä¸ç ´ä¸€è‰²é§…", lat: 35.332720, lng: 136.721678 },
  { name: "ç«¹é¼»é§…", lat: 35.326612, lng: 136.706210 },
  { name: "ç¾½å³¶å¸‚å½¹æ‰€å‰é§…", lat: 35.321669, lng: 136.699842 },
  { name: "æ±Ÿå‰è‰¯é§…", lat: 35.315583, lng: 136.699676 },
  { name: "æ–°ç¾½å³¶é§…", lat: 35.315710, lng: 136.686452 }
  ];

  const map = L.map('map').setView([35, 137], 7);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: 'Â© OpenStreetMap contributors'
  }).addTo(map);

  let userMarker;
  let routeLine;
  let markers = [];
  let userPos = null;

  function calculateDistance(lat1, lng1, lat2, lng2) {
    const R = 6371;
    const dLat = (lat2 - lat1) * Math.PI / 180;
    const dLng = (lng2 - lng1) * Math.PI / 180;
    const a = Math.sin(dLat / 2) ** 2 +
      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
      Math.sin(dLng / 2) ** 2;
    return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
  }

  function findNearestStation(lat, lng) {
    let nearest = stations[0];
    let minDist = calculateDistance(lat, lng, nearest.lat, nearest.lng);
    for (let i = 1; i < stations.length; i++) {
      const s = stations[i];
      const dist = calculateDistance(lat, lng, s.lat, s.lng);
      if (dist < minDist) {
        nearest = s;
        minDist = dist;
      }
    }
    return nearest;
  }

  function getRouteOrder(startLat, startLng, spots) {
    const remaining = spots.slice();
    const order = [];
    let currentLat = startLat;
    let currentLng = startLng;

    while (remaining.length > 0) {
      let nearestIndex = 0;
      let nearestDist = calculateDistance(currentLat, currentLng, remaining[0].lat, remaining[0].lng);
      for (let i = 1; i < remaining.length; i++) {
        const dist = calculateDistance(currentLat, currentLng, remaining[i].lat, remaining[i].lng);
        if (dist < nearestDist) {
          nearestDist = dist;
          nearestIndex = i;
        }
      }
      const nextSpot = remaining.splice(nearestIndex, 1)[0];
      order.push(nextSpot);
      currentLat = nextSpot.lat;
      currentLng = nextSpot.lng;
    }
    return order;
  }

  function drawRoute(coords) {
    if (routeLine) map.removeLayer(routeLine);
    routeLine = L.polyline(coords, { color: 'blue', weight: 5 }).addTo(map);
    map.fitBounds(routeLine.getBounds());
  }

  function clearMarkers() {
    markers.forEach(m => map.removeLayer(m));
    markers = [];
  }

  function fetchRoute(waypoints) {
    if (waypoints.length < 2) {
      alert("ãƒ«ãƒ¼ãƒˆã«å¿…è¦ãªã‚¹ãƒãƒƒãƒˆãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚");
      return;
    }
    const coords = waypoints.map(p => [p.lng, p.lat]);

    fetch('https://api.openrouteservice.org/v2/directions/foot-walking/geojson', {
      method: 'POST',
      headers: {
        'Authorization': '5b3ce3597851110001cf62487338421d75c3437b97c6fe3ace881105', // â†è‡ªåˆ†ã®APIã‚­ãƒ¼ã«å¤‰æ›´ã™ã‚‹ã“ã¨
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ coordinates: coords })
    })
      .then(res => {
        if (!res.ok) throw new Error('APIã‚¨ãƒ©ãƒ¼: ' + res.status);
        return res.json();
      })
      .then(data => {
        const geojson = data.features[0].geometry;
        const latlngs = geojson.coordinates.map(c => [c[1], c[0]]);
        drawRoute(latlngs);
      })
      .catch(err => {
        alert('ãƒ«ãƒ¼ãƒˆå–å¾—ã‚¨ãƒ©ãƒ¼: ' + err.message);
        console.error(err);
      });
  }

  // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ãªã—ã§ã€å¸¸ã«ã€Œã‚·ã‚­ã‚¶ã‚¯ãƒ©ã€ã‚«ãƒ†ã‚´ãƒªã‚’é¸æŠçŠ¶æ…‹ã«ã™ã‚‹
  function getSelectedCategories() {
    return ["ã‚·ã‚­ã‚¶ã‚¯ãƒ©"];
  }

  function updateMap() {
    if (!userPos) {
      alert('ç¾åœ¨åœ°ãŒå–å¾—ã§ãã¦ã„ã¾ã›ã‚“ã€‚');
      return;
    }

    const selectedCategories = getSelectedCategories();
    if (selectedCategories.length === 0) {
      alert('ã‚«ãƒ†ã‚´ãƒªã‚’1ã¤ä»¥ä¸Šé¸æŠã—ã¦ãã ã•ã„ã€‚');
      return;
    }

    const filteredSpots = spots.filter(s => selectedCategories.includes(s.category));
    if (filteredSpots.length === 0) {
      alert('é¸æŠã•ã‚ŒãŸã‚«ãƒ†ã‚´ãƒªã®ã‚¹ãƒãƒƒãƒˆãŒã‚ã‚Šã¾ã›ã‚“ã€‚');
      return;
    }

    clearMarkers();

    const startStation = findNearestStation(userPos.lat, userPos.lng);
    const spotWithStations = filteredSpots.map(spot => {
      const nearestStation = findNearestStation(spot.lat, spot.lng);
      return [nearestStation, spot];
    }).flat();

    const orderedPoints = getRouteOrder(userPos.lat, userPos.lng, [startStation, ...spotWithStations]);

    orderedPoints.forEach(p => {
      const isStation = stations.some(st => st.lat === p.lat && st.lng === p.lng);
      const options = isStation ? { icon: stationIcon } : {}; // â† ä¿®æ­£ãƒã‚¤ãƒ³ãƒˆ

      const marker = L.marker([p.lat, p.lng], options).addTo(map).bindPopup(p.name || "åœ°ç‚¹");
      markers.push(marker);
    });

    fetchRoute([userPos, ...orderedPoints]);
  }

  function init() {
    if (!navigator.geolocation) {
      alert('ç¾åœ¨åœ°ãŒå–å¾—ã§ãã¾ã›ã‚“');
      return;
    }
    navigator.geolocation.getCurrentPosition(pos => {
      const lat = pos.coords.latitude;
      const lng = pos.coords.longitude;
      userPos = { lat, lng };

      if (userMarker) {
        userMarker.setLatLng([lat, lng]);
      } else {
        userMarker = L.marker([lat, lng], { icon: redIcon }).addTo(map).bindPopup('ç¾åœ¨åœ°').openPopup();
      }
      map.setView([lat, lng], 10);

      updateMap();
    }, () => alert('ç¾åœ¨åœ°ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ'));
  }

  // ãƒœã‚¿ãƒ³ã¯ç„¡ããªã£ãŸã®ã§ã€ã“ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã¯å‰Šé™¤ã—ã¦ã„ã¾ã™

  init();
</script>
</body>
</html>
